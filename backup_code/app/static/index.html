<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Comic Voice Agent - Accessible Comic Reader</title>

    <!-- Accessibility: Ensure proper language is set -->
    <meta http-equiv="Content-Language" content="en" />

    <!-- Theme color for mobile browsers -->
    <meta name="theme-color" content="#1a365d" />

    <!-- Preconnect for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Main stylesheet -->
    <link rel="stylesheet" href="/static/css/styles.css" />

    <!-- Skip link for accessibility -->
    <style>
      .skip-link {
        position: absolute;
        top: -40px;
        left: 0;
        background: #1a365d;
        color: white;
        padding: 8px 16px;
        z-index: 100;
        text-decoration: none;
        font-weight: 600;
      }
      .skip-link:focus {
        top: 0;
      }
    </style>
  </head>
  <body>
    <!-- Skip Navigation Link (Accessibility) -->
    <a href="#main-content" class="skip-link">Skip to main content</a>

    <!-- Header -->
    <header role="banner">
      <div class="header-content">
        <h1>
          <span class="logo-icon" aria-hidden="true">üìñ</span>
          Comic Voice Agent
        </h1>
        <p class="subtitle">Making comic books accessible for everyone</p>
      </div>

      <!-- Connection Status (Accessible) -->
      <div class="connection-status" role="status" aria-live="polite">
        <span id="status-dot" class="status-dot" aria-hidden="true"></span>
        <span id="connection-status">Connecting...</span>
      </div>
    </header>

    <!-- Main Content -->
    <main id="main-content" role="main">
      <!-- Upload Section -->
      <section
        id="upload-section"
        class="section upload-section"
        aria-labelledby="upload-heading"
      >
        <h2 id="upload-heading" class="visually-hidden">Upload Comic Book</h2>

        <div
          class="upload-container"
          id="drop-zone"
          role="button"
          tabindex="0"
          aria-label="Upload comic book PDF. Click or drag and drop a file here."
          aria-describedby="upload-instructions"
        >
          <div class="upload-icon" aria-hidden="true">üìö</div>
          <p class="upload-text">
            <strong>Drop your comic book PDF here</strong>
            <br />
            <span class="upload-subtext">or click to browse</span>
          </p>
          <p id="upload-instructions" class="upload-instructions">
            Supported format: PDF. Maximum size: 50MB
          </p>

          <input
            type="file"
            id="file-input"
            accept=".pdf"
            class="visually-hidden"
            aria-label="Select PDF file"
          />
        </div>

        <!-- Upload Progress -->
        <div
          id="upload-progress"
          class="upload-progress"
          role="progressbar"
          aria-hidden="true"
        >
          <div class="progress-bar">
            <div id="progress-fill" class="progress-fill"></div>
          </div>
          <p id="progress-text" aria-live="polite">Uploading...</p>
        </div>
      </section>

      <!-- Comic Reader Section (Hidden until comic loaded) -->
      <section
        id="reader-section"
        class="section reader-section"
        aria-labelledby="reader-heading"
        hidden
      >
        <h2 id="reader-heading" class="visually-hidden">Comic Reader</h2>

        <!-- Comic Info Bar -->
        <div class="comic-info" role="region" aria-label="Comic information">
          <h3 id="comic-title" class="comic-title">Comic Title</h3>
          <p id="comic-author" class="comic-author">by Author</p>
          <p id="page-indicator" class="page-indicator" aria-live="polite">
            Page <span id="current-page">1</span> of
            <span id="total-pages">1</span>
          </p>
        </div>

        <!-- Chat/Narration Container -->
        <div class="chat-container">
          <div
            id="messages"
            class="messages"
            role="log"
            aria-live="polite"
            aria-label="Story narration and responses"
          >
            <!-- Messages will be inserted here -->
          </div>

          <!-- Typing Indicator -->
          <div
            id="typing-indicator"
            class="typing-indicator"
            aria-hidden="true"
          >
            <span></span><span></span><span></span>
            <span class="typing-text">Reading...</span>
          </div>
        </div>

        <!-- Navigation Controls -->
        <nav class="navigation-controls" aria-label="Page navigation">
          <button
            id="prev-page-btn"
            class="nav-btn nav-btn-prev"
            aria-label="Previous page"
            disabled
          >
            <span aria-hidden="true">‚óÄ</span>
            Previous
          </button>

          <button
            id="read-btn"
            class="nav-btn nav-btn-primary"
            aria-label="Read current page"
          >
            <span aria-hidden="true">‚ñ∂</span>
            Read Page
          </button>

          <button
            id="next-page-btn"
            class="nav-btn nav-btn-next"
            aria-label="Next page"
            disabled
          >
            Next
            <span aria-hidden="true">‚ñ∂</span>
          </button>
        </nav>

        <!-- Voice Input Section -->
        <div class="input-section">
          <form id="message-form" class="message-form">
            <label for="message-input" class="visually-hidden">
              Type your message or question
            </label>
            <input
              type="text"
              id="message-input"
              class="message-input"
              placeholder="Ask me anything or type a command..."
              autocomplete="off"
              aria-describedby="input-help"
            />

            <button
              type="submit"
              id="send-btn"
              class="send-btn"
              aria-label="Send message"
            >
              <span aria-hidden="true">‚û§</span>
              Send
            </button>
          </form>

          <p id="input-help" class="input-help">
            Try: "read", "next page", "describe this", or ask any question
          </p>

          <!-- Voice Controls -->
          <div class="voice-controls">
            <button
              id="start-voice-btn"
              class="voice-btn voice-btn-start"
              aria-label="Start voice input"
            >
              <span aria-hidden="true">üé§</span>
              Speak
            </button>

            <button
              id="stop-voice-btn"
              class="voice-btn voice-btn-stop"
              aria-label="Stop voice input"
              hidden
            >
              <span aria-hidden="true">‚¨õ</span>
              Stop
            </button>

            <div id="recording-indicator" class="recording-indicator" hidden>
              <span class="recording-dot" aria-hidden="true"></span>
              <span>Listening...</span>
            </div>
          </div>
        </div>
      </section>

      <!-- Quick Actions (Always Visible) -->
      <section class="quick-actions" aria-label="Quick actions">
        <button id="help-btn" class="action-btn" aria-label="Get help">
          <span aria-hidden="true">‚ùì</span>
          Help
        </button>

        <button id="settings-btn" class="action-btn" aria-label="Open settings">
          <span aria-hidden="true">‚öôÔ∏è</span>
          Settings
        </button>

        <button
          id="high-contrast-btn"
          class="action-btn"
          aria-label="Toggle high contrast mode"
        >
          <span aria-hidden="true">üåì</span>
          Contrast
        </button>
      </section>
    </main>

    <!-- Settings Modal -->
    <div
      id="settings-modal"
      class="modal"
      role="dialog"
      aria-labelledby="settings-title"
      aria-hidden="true"
    >
      <div class="modal-content">
        <h2 id="settings-title">Settings</h2>

        <div class="setting-group">
          <label for="speech-rate">Speech Rate</label>
          <input
            type="range"
            id="speech-rate"
            min="0.5"
            max="2"
            step="0.1"
            value="1"
            aria-describedby="speech-rate-value"
          />
          <span id="speech-rate-value">1.0x</span>
        </div>

        <div class="setting-group">
          <label for="voice-select">Voice</label>
          <select id="voice-select">
            <option value="Puck">Puck (Default)</option>
            <option value="Kore">Kore</option>
            <option value="Charon">Charon</option>
            <option value="Fenrir">Fenrir</option>
            <option value="Aoede">Aoede</option>
          </select>
        </div>

        <div class="setting-group">
          <label>
            <input type="checkbox" id="child-mode" />
            Child-Friendly Mode
          </label>
          <p class="setting-description">
            Simpler language and shorter descriptions
          </p>
        </div>

        <div class="setting-group">
          <label>
            <input type="checkbox" id="auto-advance" />
            Auto-advance Pages
          </label>
          <p class="setting-description">
            Automatically go to next page after narration
          </p>
        </div>

        <div class="modal-actions">
          <button id="close-settings" class="btn btn-primary">
            Save & Close
          </button>
        </div>
      </div>
    </div>

    <!-- Help Modal -->
    <div
      id="help-modal"
      class="modal"
      role="dialog"
      aria-labelledby="help-title"
      aria-hidden="true"
    >
      <div class="modal-content">
        <h2 id="help-title">How to Use Comic Voice Agent</h2>

        <div class="help-section">
          <h3>Getting Started</h3>
          <ol>
            <li>Upload a comic book PDF using the upload area</li>
            <li>Wait for the comic to be processed</li>
            <li>Click "Read Page" or say "read" to start</li>
          </ol>
        </div>

        <div class="help-section">
          <h3>Voice Commands</h3>
          <ul>
            <li><strong>"Read"</strong> - Start reading the current page</li>
            <li><strong>"Next page"</strong> - Go to the next page</li>
            <li><strong>"Previous page"</strong> - Go back</li>
            <li>
              <strong>"Describe this"</strong> - Get a detailed description
            </li>
            <li>
              <strong>"Who is [character]?"</strong> - Learn about a character
            </li>
            <li><strong>"What's happening?"</strong> - Quick summary</li>
            <li><strong>"Help"</strong> - Hear all commands</li>
          </ul>
        </div>

        <div class="help-section">
          <h3>Keyboard Shortcuts</h3>
          <table class="shortcuts-table">
            <tr>
              <td><kbd>Space</kbd></td>
              <td>Play/Pause</td>
            </tr>
            <tr>
              <td><kbd>‚Üí</kbd></td>
              <td>Next page</td>
            </tr>
            <tr>
              <td><kbd>‚Üê</kbd></td>
              <td>Previous page</td>
            </tr>
            <tr>
              <td><kbd>R</kbd></td>
              <td>Repeat</td>
            </tr>
            <tr>
              <td><kbd>D</kbd></td>
              <td>Describe</td>
            </tr>
            <tr>
              <td><kbd>H</kbd></td>
              <td>Help</td>
            </tr>
            <tr>
              <td><kbd>Esc</kbd></td>
              <td>Stop/Close</td>
            </tr>
          </table>
        </div>

        <div class="modal-actions">
          <button id="close-help" class="btn btn-primary">Got it!</button>
        </div>
      </div>
    </div>

    <!-- Status Announcer for Screen Readers -->
    <div
      id="sr-announcer"
      class="visually-hidden"
      role="status"
      aria-live="assertive"
      aria-atomic="true"
    ></div>

    <!-- Scripts -->
    <script type="module" src="/static/js/app.js"></script>
  </body>
</html>
